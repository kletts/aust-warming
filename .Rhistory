import cdsapi
import datetime
import netCDF4
import numpy as np
import pandas as pd
import sys
import os
from dotenv import load_dotenv
load_dotenv()
import cdsapi
import datetime
import netCDF4
import numpy as np
import pandas as pd
import sys
import os
from dotenv import load_dotenv
load_dotenv()
ct = datetime.date.today() + datetime.timedelta(days=-30)
ct2 = datetime.date.today() + datetime.timedelta(days=-60)
ct
ct2
dataset = "reanalysis-era5-land-monthly-means"
request = {
"product_type": ["monthly_averaged_reanalysis"],
"variable": ["2m_temperature"],
"year": [ ct.year ],
"month": [ ct.month, ct2.month ],
"time": ["00:00"],
"data_format": "netcdf",
"download_format": "unarchived",
"area": [-9, 112, -44, 160]
}
target = 'download.nc'
client = cdsapi.Client(
url="https://cds.climate.copernicus.eu/api",
key=os.getenv('CDSAPIKEY'))
client.retrieve(dataset, request, target)
obs = netCDF4.Dataset('download.nc', 'r')
obs
ct3 = datetime.date.today() + datetime.timedelta(days=-90)
request = {
"product_type": ["monthly_averaged_reanalysis"],
"variable": ["2m_temperature"],
"year": [ ct.year ],
"month": [ ct.month, ct2.month, ct3.month ],
"time": ["00:00"],
"data_format": "netcdf",
"download_format": "unarchived",
"area": [-9, 112, -44, 160]
}
target = 'download.nc'
client.retrieve(dataset, request, target)
obs = netCDF4.Dataset('download.nc', 'r')
obs
data = obs.variables['t2m']
data
obs.variables
data
obs.dimensions
collections = client.get_collections(sortby="update")
datetime.date.today()
datetime.date.today().day()
datetime.date.today().day
if datetime.date.today().day < 25:
ct = datetime.date.today() + datetime.timedelta(days=-60)
else:
ct = datetime.date.today() + datetime.timedelta(days=-30)
reticulate::repl_python()
url <- "https://www.ncei.noaa.gov/access/monitoring/climate-at-a-glance/global/time-series/globe/land_ocean/tavg/1/0/1850-2025/data.csv"
data <- read_csv(url, skip=3)
library(tidyverse)
?read_csv
data <- read_csv(url, skip=3, col_types = "cn")
data
url <- "https://www.ncei.noaa.gov/access/monitoring/climate-at-a-glance/global/time-series/globe/land_ocean/tavg/1/0/1850-2026/data.csv"
data <- read_csv(url, skip=3, col_types = "cn")
url <- "https://www.ncei.noaa.gov/access/monitoring/climate-at-a-glance/global/time-series/north/land_ocean/tavg/1/0/1850-2025/data.csv"
data <- read_csv(url, skip=3, col_types = "cn")
Sys.Date() %m-% months(1)
format(Sys.Date() %m-% months(1), "%Y")
area <- c("Global"="globe",
"North"="nhem",
"South"="shem")
yr <- format(Sys.Date() %m-% months(1), "%Y")
url <- glue::glue("https://www.ncei.noaa.gov/access/monitoring/climate-at-a-glance/global/time-series/{area}/land_ocean/tavg/1/0/1850-{yr}/data.csv")
url
yr <- format(Sys.Date() %m-% months(1), "%Y")
url <- glue::glue("https://www.ncei.noaa.gov/access/monitoring/climate-at-a-glance/global/time-series/{area}/land_ocean/tavg/1/0/1850-{yr}/data.csv")
url <- setNames(url, names(area))
url
url
names(area)
?setNames
area <- c("Global"="globe",
"North"="nhem",
"South"="shem")
yr <- format(Sys.Date() %m-% months(1), "%Y")
url <- glue::glue("https://www.ncei.noaa.gov/access/monitoring/climate-at-a-glance/global/time-series/{area}/land_ocean/tavg/1/0/1850-{yr}/data.csv")
url <- setNames(url, names(area))
url
str(url)
data <- lapply(url, read_csv, skip=3, col_types = "cn")
data
read_temp <- function(url, region) {
readr::read_csv(url, skip=3, col_types="cn") |>
dplyr::mutate(Region = region,
Date = as.Date(paste0(Date, "01"), "%Y%m%d")) }
area <- c("Global"="globe",
"North"="nhem",
"South"="shem")
yr <- format(Sys.Date() %m-% months(1), "%Y")
url <- glue::glue("https://www.ncei.noaa.gov/access/monitoring/climate-at-a-glance/global/time-series/{area}/land_ocean/tavg/1/0/1850-{yr}/data.csv")
url <- setNames(url, names(area))
url
data <- imap_dfr(url, read_temp)
data
ggplot(data, aes(x=Date, y=Anomaly, col=Region)) + geom_line()
import pandas as pd
reticulate::repl_python()
